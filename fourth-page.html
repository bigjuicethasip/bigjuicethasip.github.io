<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BJTS Forums</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #1e1e1e;
            color: #ffffff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .forum-container {
            width: 80%;
            max-width: 1200px;
            margin-top: 20px;
            padding: 20px;
            background: #2c2c2c;
            border-radius: 10px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        .forum-thread {
            margin-bottom: 20px;
            padding: 15px;
            background: #3a3a3a;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .forum-thread:hover {
            background: #4a4a4a;
        }

        .forum-thread h2 {
            margin: 0;
        }

        .forum-thread p {
            margin: 5px 0 0 0;
        }

        .forum-thread img {
            max-width: 100%;
            margin-top: 10px;
            border-radius: 5px;
        }

        .new-thread {
            margin-top: 30px;
            padding: 15px;
            background: #4a4a4a;
            border-radius: 5px;
        }

        .new-thread input,
        .new-thread textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: none;
            border-radius: 5px;
            background: #3a3a3a;
            color: #ffffff;
            font-family: Arial, sans-serif;
        }

        .new-thread button {
            padding: 10px 20px;
            background: #ffa500;
            color: #1e1e1e;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .new-thread button:hover {
            background: #ff8c00;
        }

        .new-thread input[type="file"] {
            padding: 0;
            color: #ffffff;
        }

        .no-threads {
            text-align: center;
            margin-top: 20px;
            font-size: 1.2em;
            color: #999;
        }

        .error {
            color: red;
            font-size: 1em;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="forum-container">
        <h1>BJTS Forums</h1>

        <div id="threads">
            <div class="no-threads">No threads yet. Be the first to post!</div>
        </div>

        <div class="new-thread">
            <h2>Create a New Thread</h2>
            <input type="text" id="username" placeholder="Username">
            <input type="text" id="thread-title" placeholder="Thread Title">
            <textarea id="thread-content" rows="4" placeholder="What do you want to discuss?"></textarea>
            <input type="file" id="thread-file">
            <button id="post-thread">Post Thread</button>
            <div id="error-message" class="error"></div>
        </div>
    </div>

    <script>
        // Function to load threads from localStorage
        function loadThreads() {
            const threadsContainer = document.getElementById('threads');
            const storedThreads = JSON.parse(localStorage.getItem('threads')) || [];

            if (storedThreads.length > 0) {
                document.querySelector('.no-threads').style.display = 'none';
                storedThreads.forEach(thread => {
                    const newThread = document.createElement('div');
                    newThread.className = 'forum-thread';
                    newThread.innerHTML = `<h2>${thread.title}</h2><p>${thread.content}</p>`;
                    
                    // Check if the thread has an attached image
                    if (thread.file) {
                        const threadImage = document.createElement('img');
                        threadImage.src = thread.file;
                        newThread.appendChild(threadImage);
                    }

                    threadsContainer.appendChild(newThread);
                });
            }
        }

        // Function to save threads to localStorage
        function saveThread(username, title, content, file) {
            const storedThreads = JSON.parse(localStorage.getItem('threads')) || [];
            storedThreads.push({ username, title, content, file });
            localStorage.setItem('threads', JSON.stringify(storedThreads));
        }

        // Function to get taken usernames from localStorage
        function getTakenUsernames() {
            const storedThreads = JSON.parse(localStorage.getItem('threads')) || [];
            return new Set(storedThreads.map(thread => thread.username));
        }

        document.getElementById('post-thread').addEventListener('click', function() {
            const username = document.getElementById('username').value.trim();
            const title = document.getElementById('thread-title').value.trim();
            const content = document.getElementById('thread-content').value.trim();
            const fileInput = document.getElementById('thread-file');
            let fileData = null;
            const errorMessage = document.getElementById('error-message');

            // Clear previous error message
            errorMessage.textContent = '';

            // Validate username
            if (!username || !/^[\w\s]+$/.test(username)) {
                errorMessage.textContent = 'Please enter a valid username (letters, numbers, and spaces only).';
                return;
            }

            // Check if username is taken
            const takenUsernames = getTakenUsernames();
            if (takenUsernames.has(username)) {
                errorMessage.textContent = 'Username is already taken. Please choose another.';
                return;
            }

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileData = e.target.result;
                    saveThreadAndReload(username, title, content, fileData);
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                saveThreadAndReload(username, title, content, null);
            }
        });

        function saveThreadAndReload(username, title, content, fileData) {
            if (title && content) {
                const threadsContainer = document.getElementById('threads');
                const noThreadsMessage = document.querySelector('.no-threads');

                // Remove the "No threads yet" message if it exists
                if (noThreadsMessage) {
                    noThreadsMessage.style.display = 'none';
                }

                // Create new thread element
                const newThread = document.createElement('div');
                newThread.className = 'forum-thread';
                newThread.innerHTML = `<h2>${title}</h2><p>${content}</p><small>Posted by: ${username}</small>`;

                // If there is a file, create an image element
                if (fileData) {
                    const threadImage = document.createElement('img');
                    threadImage.src = fileData;
                    newThread.appendChild(threadImage);
                }

                // Add new thread to the forum
                threadsContainer.appendChild(newThread);

                // Save the new thread to localStorage
                saveThread(username, title, content, fileData);

                // Clear the input fields
                document.getElementById('username').value = '';
                document.getElementById('thread-title').value = '';
                document.getElementById('thread-content').value = '';
                document.getElementById('thread-file').value = '';
            }
        }

        // Load threads when the page loads
        window.onload = loadThreads;
    </script>
</body>
</html>
